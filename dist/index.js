(()=>{function T(c){return new Promise((t,s)=>{loadedPlugins.LibEAPIRequest.eapiRequest(`${APP_CONF.domain}/api/song/lyric/v1`,{type:"json",query:{id:c,cp:!1,tv:0,lv:0,rv:0,kv:0,yv:0,ytv:0,yrv:0},onload:t,onerror:s})})}var S=[{time:0,duration:594e4,originalLyric:"纯音乐，请欣赏"}],q={sgc:!1,sfy:!1,qfy:!1,needDesc:!0,lrc:{version:1,lyric:`[99:00.00]纯音乐，请欣赏
`},code:200,briefDesc:null};function M(c,t="",s="",m=""){if(m.trim().length===0){let n=p(c).map(i=>({time:i.time,originalLyric:i.lyric,duration:0}));p(t).forEach(i=>{let e=n.find(o=>o.time===i.time);e&&(e.translatedLyric=i.lyric)}),p(s).forEach(i=>{let e=n.find(o=>o.time===i.time);e&&(e.romanLyric=i.lyric)}),n.sort((i,e)=>i.time-e.time);let r=I(n);for(let i=0;i<r.length;i++)i<r.length-1&&(r[i].duration=r[i+1].time-r[i].time);return I(n)}else{let n=A(m);p(t).forEach(r=>{let i=n.find(e=>e.time===r.time);i||n.forEach(e=>{i?Math.abs(i.time-r.time)>Math.abs(e.time-r.time)&&(i=e):i=e}),i&&(i.translatedLyric=i.translatedLyric||"",i.translatedLyric.length>0&&(i.translatedLyric+=" "),i.translatedLyric+=r.lyric)}),p(s).forEach(r=>{let i=null;n.forEach(e=>{i?Math.abs(i.time-r.time)>Math.abs(e.time-r.time)&&(i=e):i=e}),i&&(i.romanLyric=i.romanLyric||"",i.romanLyric.length>0&&(i.romanLyric+=" "),i.romanLyric+=r.lyric)});for(let r=0;r<n.length;r++){let i=n[r],e=n[r+1];if(i&&e&&i.originalLyric.trim().length>0&&e.originalLyric.trim().length>0&&i.duration>0){let o=((i==null?void 0:i.dynamicLyricTime)||i.time)+i.duration,l=e.time;e.dynamicLyricTime&&l>e.dynamicLyricTime&&(l=e.dynamicLyricTime),l-o>=5e3&&n.splice(r+1,0,{time:o,originalLyric:"",duration:l-o})}}return I(n)}}var _=new RegExp("^\\[(?<time>[0-9]+),(?<duration>[0-9]+)\\](?<line>.*)"),v=new RegExp("^\\((?<time>[0-9]+),(?<duration>[0-9]+),(?<flag>[0-9]+)\\)(?<word>[^\\(]*)"),C=new RegExp("^\\[((?<min>[0-9]+):)?(?<sec>[0-9]+([\\.:]([0-9]+))?)\\]");function p(c){var s,m;let t=[];for(let n of c.split(`
`)){let r=n.trim(),i=[];for(;;){let e=r.match(C);if(e){let o=Number(((s=e.groups)==null?void 0:s.min)||"0"),l=Number(((m=e.groups)==null?void 0:m.sec.replace(/:/,"."))||"0");i.push(Math.floor((o*60+l)*1e3)),r=r.slice(0,e.index)+r.slice((e.index||0)+e[0].length),r=r.trim()}else break}r=r.trim();for(let e of i)t.push({time:e,lyric:r})}return t.sort((n,r)=>n.time-r.time),t}function A(c){var s,m,n,r,i,e,o;let t=[];for(let l of c.trim().split(`
`)){let g=l.trim(),E=g.match(_);if(E){let b=parseInt(((s=E.groups)==null?void 0:s.time)||"0"),R=parseInt(((m=E.groups)==null?void 0:m.duration)||"0");g=((n=E.groups)==null?void 0:n.line)||"";let L=[];for(;g.length>0;){let y=g.match(v);if(y){let d=parseInt(((r=y.groups)==null?void 0:r.time)||"0"),D=parseInt(((i=y.groups)==null?void 0:i.duration)||"0"),h=parseInt(((e=y.groups)==null?void 0:e.flag)||"0"),u=(o=y.groups)==null?void 0:o.word.trimStart(),x=u==null?void 0:u.split(/\s+/).filter(a=>a.trim().length>0);if(x){let a=D/x.length;x.forEach((P,f)=>{f===x.length-1?u!=null&&u.endsWith(" ")?L.push({time:d+f*a,duration:a,flag:h,word:`${P.trimStart()} `}):L.push({time:d+f*a,duration:a,flag:h,word:P.trimStart()}):f===0?u!=null&&u.startsWith(" ")?L.push({time:d+f*a,duration:a,flag:h,word:` ${P.trimStart()}`}):L.push({time:d+f*a,duration:a,flag:h,word:P.trimStart()}):L.push({time:d+f*a,duration:a,flag:h,word:`${P.trimStart()} `})})}g=g.slice(y.index||0+y[0].length)}else break}let w={time:b,duration:R,originalLyric:L.map(y=>y.word).join(""),dynamicLyric:L,dynamicLyricTime:b};t.push(w)}}return t}function I(c){var m,n,r;if(c.length>0&&c[c.length-1].time===594e4&&c[c.length-1].duration===0)return S;let t=[],s=!1;for(c.forEach((i,e,o)=>{if(i.originalLyric.trim().length===0){let l=o[e+1];l&&l.time-i.time>5e3&&!s&&(t.push(i),s=!0)}else s=!1,t.push(i)});((m=t[0])==null?void 0:m.originalLyric.length)===0;)t.shift();return((n=t[0])==null?void 0:n.time)>5e3&&t.unshift({time:500,duration:((r=t[0])==null?void 0:r.time)-500,originalLyric:""}),t}plugin.onLoad(c=>{let t=c.mainPlugin;t.parseLyric=M,t.getLyricData=T,t.parsePureLyric=p,t.parsePureDynamicLyric=A});})();
